<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دليلك الشامل للإكسل</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Light gray background */
            color: #374151; /* Dark gray text */
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }
        .section-title {
            border-bottom: 2px solid #10B981; /* Green border - previously indigo */
            padding-bottom: 0.5rem;
            margin-bottom: 1.5rem;
        }
        .card {
            background-color: #ffffff;
            border-radius: 0.75rem; /* Rounded corners */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .code-block {
            background-color: #D1FAE5; /* Light green - previously light indigo */
            color: #047857; /* Darker green - previously darker indigo */
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-family: monospace;
            overflow-x: auto;
            direction: ltr; /* Ensure code is LTR */
            text-align: left; /* Align code to left */
        }
        .table-container {
            overflow-x: auto;
            margin-top: 1rem; /* Add some margin above tables for spacing */
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        th, td {
            border: 1px solid #d1d5db; /* Light gray border */
            padding: 0.75rem;
            text-align: right;
        }
        th {
            background-color: #ECFDF5; /* Lighter green - previously lighter indigo */
            font-weight: 600;
        }
        .nav-button {
            @apply px-4 py-2 rounded-md transition-colors duration-200;
        }
        .nav-button.active {
            @apply bg-emerald-800; /* Darker green for active button - previously indigo */
        }
        .nav-button:hover:not(.active) {
            @apply bg-emerald-600; /* Medium green for hover - previously indigo */
        }
        .content-section {
            display: none; /* Hidden by default */
        }
        .content-section.active {
            display: block; /* Shown when active */
        }

        /* Styles for the password overlay page */
        #password-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(16, 185, 129, 0.95); /* Semi-transparent green background */
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 1000;
            transition: opacity 0.5s ease-in-out;
        }

        #password-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        
        .password-box {
            background-color: white;
            padding: 2.5rem;
            border-radius: 1rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 400px;
            width: 90%;
        }

        .password-input {
            border: 2px solid #D1FAE5;
            padding: 0.75rem;
            border-radius: 0.5rem;
            width: 100%;
            text-align: center;
            font-size: 1.25rem;
        }

        .password-button {
            @apply bg-emerald-700 text-white font-bold py-2 px-6 rounded-md mt-4 transition-colors duration-200 hover:bg-emerald-800;
        }
    </style>
</head>
<body class="antialiased">

    <!-- Password Overlay Page -->
    <div id="password-overlay" class="flex">
        <div class="password-box">
            <h2 class="text-3xl font-bold text-emerald-800 mb-4">أهلاً بك</h2>
            <p class="text-gray-600 mb-6">الرجاء إدخال رمز المرور للمتابعة.</p>
            <input type="password" id="password-input" class="password-input mb-4" placeholder="أدخل الرمز هنا">
            <button id="password-button" class="password-button">الدخول</button>
            <p id="password-message" class="text-red-500 mt-3 hidden">كلمة المرور خاطئة. حاول مرة أخرى.</p>
        </div>
    </div>

    <!-- Header and Navigation -->
    <header class="bg-emerald-700 text-white py-4 rounded-b-xl shadow-lg"> <!-- Green header - previously indigo -->
        <div class="container flex flex-col md:flex-row items-center justify-between">
            <h1 class="text-3xl font-bold mb-4 md:mb-0">المحاسب الشاطر</h1>
            <nav>
                <ul class="flex flex-wrap justify-center gap-2 md:gap-4">
                    <li><button class="nav-button active" data-target="home">الرئيسية</button></li>
                    <li><button class="nav-button" data-target="formulas">معادلات الإكسل</button></li>
                    <li><button class="nav-button" data-target="shortcuts">اختصارات الإكسل</button></li>
                    <li><button class="nav-button" data-target="problems">حلول مشاكل الإكسل</button></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="container py-8">
        <!-- Home Section (About Me) -->
        <section id="home" class="content-section active mb-12">
            <h2 class="text-3xl font-semibold section-title text-emerald-800">مرحباً بك في دليلك الشامل للإكسل!</h2> <!-- Green title - previously indigo -->
            <div class="card">
                <div class="flex flex-col md:flex-row items-center md:items-start gap-6 mb-6">
                    <div class="flex-shrink-0">
                        <!-- Note: The image URLs below appear to be placeholder names, you may want to update them -->
                        <img src="d.png" alt="[صورة أحمد العليمي يرتدي هودي أخضر]" class="w-48 h-48 object-cover rounded-full shadow-lg border-4 border-emerald-500">
                    </div>
                    <div>
                        <h3 class="text-2xl font-bold text-emerald-700 mb-2">أحمد العليمي</h3>
                        <p class="text-lg mb-4">
                            أهلاً وسهلاً بك في هذا الموقع المتواضع، الذي يهدف إلى أن يكون مرجعك السريع والشامل لكل ما يتعلق ببرنامج مايكروسوفت إكسل.
                            اسمي أحمد العليمي، وأنا هنا لأشاركك خبرتي في هذا البرنامج القوي.
                        </p>
                        <p class="text-lg mb-4">
                            سواء كنت مبتدئاً تسعى لتعلم الأساسيات، أو مستخدماً متقدماً تبحث عن اختصارات ومعادلات لزيادة إنتاجيتك،
                            فقد صُمم هذا الدليل لمساعدتك. ستجد هنا شروحات وافية لأهم معادلات الإكسل،
                            وقائمة بأكثر الاختصارات استخداماً لتوفير وقتك وجهدك،
                            بالإضافة إلى حلول لبعض المشاكل الشائعة التي قد تواجهها أثناء عملك على البرنامج.
                        </p>
                        <p class="text-lg">
                            أتمنى أن تجد هذا الموقع مفيداً وأن يساعدك في إتقان إكسل والعمل عليه بكفاءة أكبر.
                            لا تتردد في استكشاف الأقسام المختلفة والاستفادة من المحتوى المقدم.
                        </p>
                    </div>
                </div>
                <div class="flex flex-wrap justify-center gap-4 mt-6">
                     <!-- Note: The image URLs below appear to be placeholder names, you may want to update them -->
                    <img src="a.png" alt="[صورة أحمد العليمي في مكتب زجاجي]" class="w-40 h-40 object-cover rounded-lg shadow-md border-2 border-emerald-300">
                    <img src="e.png" alt="[صورة أحمد العليمي يرتدي هودي أخضر ويحمل تابلت]" class="w-40 h-40 object-cover rounded-lg shadow-md border-2 border-emerald-300">
                </div>
            </div>

            <!-- AI Feature Card -->
            <div class="card mt-8">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">✨ مولد ومحلل دوال الإكسل بالذكاء الاصطناعي ✨</h3>
                <p class="mb-4">
                    اطلب من الذكاء الاصطناعي شرح أي دالة إكسل، أو اطلب منه إنشاء دالة بناءً على وصفك! يمكنك أيضاً إضافة صورة لتحليلها.
                </p>
                <!-- New file input and image preview -->
                <div class="mb-4">
                    <label for="image-upload" class="flex items-center justify-center p-3 border border-dashed border-gray-300 rounded-md cursor-pointer hover:bg-gray-50 transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" />
                        </svg>
                        <span class="mr-2 text-sm text-gray-600">اختر صورة أو اسحبها هنا</span>
                        <input type="file" id="image-upload" class="hidden" accept="image/*">
                    </label>
                    <div id="image-preview-container" class="relative mt-2 hidden">
                        <img id="image-preview" class="max-w-full h-auto rounded-md shadow-md mx-auto">
                        <button id="clear-image" class="absolute top-1 left-1 bg-red-500 text-white rounded-full p-1 leading-none shadow-md">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                        </button>
                    </div>
                </div>

                <textarea id="ai-input" class="w-full p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-emerald-500 mb-4" rows="4" placeholder="مثال: كيف أجمع الأرقام في العمود A إذا كانت أكبر من 10؟ أو اشرح لي دالة VLOOKUP؟"></textarea>
                <button id="ai-button" class="bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-2 px-4 rounded-md transition-colors duration-200 shadow-md">
                    احصل على المساعدة من الذكاء الاصطناعي
                </button>
                <div id="ai-loading" class="hidden text-center mt-4 text-emerald-700">
                    <p>جاري التفكير... الرجاء الانتظار</p>
                </div>
                <div id="ai-output" class="card mt-4 hidden">
                    <h4 class="text-xl font-semibold text-emerald-700 mb-2">الاستجابة:</h4>
                    <div id="ai-response-content" class="text-gray-700"></div>
                </div>
            </div>
        </section>

        <!-- Formulas Section -->
        <section id="formulas" class="content-section mb-12">
            <h2 class="text-3xl font-semibold section-title text-emerald-800">معادلات الإكسل الأساسية</h2> <!-- Green title - previously indigo -->
            <p class="text-lg mb-6">
                هذا القسم سيتم تحديثه باستمرار ليشمل أكثر من 200 دالة من دوال الإكسل الهامة مع شروحات وأمثلة.
                تعلم هذه المعادلات سيساعدك على تحليل البيانات بكفاءة عالية.
            </p>

            <!-- SUM Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">1. SUM (الجمع)</h3>
                <p class="mb-2">تستخدم لجمع نطاق من الأرقام.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =SUM(number1, [number2], ...)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =SUM(A1:A10) <br>
                    يجمع الأرقام من الخلية A1 إلى A10.
                </div>
            </div>

            <!-- AVERAGE Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">2. AVERAGE (المتوسط)</h3>
                <p class="mb-2">تحسب متوسط نطاق من الأرقام.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =AVERAGE(number1, [number2], ...)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =AVERAGE(B1:B5) <br>
                    يحسب متوسط الأرقام في الخلايا من B1 إلى B5.
                </div>
            </div>

            <!-- IF Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">3. IF (إذا)</h3>
                <p class="mb-2">تتحقق من شرط معين وتعيد قيمة إذا كان الشرط صحيحًا، وقيمة أخرى إذا كان خاطئًا.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =IF(logical_test, value_if_true, [value_if_false])
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =IF(C1>100, "ناجح", "راسب") <br>
                    إذا كانت قيمة C1 أكبر من 100، تعرض "ناجح"، وإلا تعرض "راسب".
                </div>
            </div>

            <!-- VLOOKUP Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">4. VLOOKUP (البحث العمودي)</h3>
                <p class="mb-2">تبحث عن قيمة في العمود الأول من جدول وتعيد قيمة من نفس الصف في عمود محدد.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =VLOOKUP(lookup_value, table_array, col_index_num, [range_lookup])
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =VLOOKUP("تفاح", A1:C10, 2, FALSE) <br>
                    تبحث عن "تفاح" في العمود A من النطاق A1:C10 وتعيد القيمة من العمود الثاني (B) في نفس الصف.
                </div>
            </div>

            <!-- CONCATENATE Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">5. CONCATENATE (دمج النصوص)</h3>
                <p class="mb-2">تدمج سلسلتين نصيتين أو أكثر في سلسلة واحدة. (يمكن استخدام & بدلاً منها)</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =CONCATENATE(text1, [text2], ...)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =CONCATENATE("مرحباً", " ", "بك") <br>
                    تدمج النصوص لتعرض "مرحباً بك".
                </div>
            </div>

            <!-- COUNTIF Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">6. COUNTIF (العد بشرط)</h3>
                <p class="mb-2">تحسب عدد الخلايا ضمن نطاق معين تستوفي شرطاً محدداً.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =COUNTIF(range, criteria)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =COUNTIF(A1:A10, ">50") <br>
                    يحسب عدد الخلايا في النطاق A1:A10 التي تحتوي على قيم أكبر من 50.
                </div>
            </div>

            <!-- SUMIFS Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">7. SUMIFS (الجمع بشروط متعددة)</h3>
                <p class="mb-2">تجمع الخلايا في نطاق يستوفي شروطاً متعددة.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =SUMIFS(sum_range, criteria_range1, criteria1, [criteria_range2, criteria2], ...)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =SUMIFS(C1:C10, A1:A10, "منتج أ", B1:B10, ">100") <br>
                    يجمع القيم في C1:C10 حيث يكون المنتج "منتج أ" في العمود A والكمية أكبر من 100 في العمود B.
                </div>
            </div>

            <!-- INDEX MATCH Combination -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">8. INDEX + MATCH (البحث المتقدم)</h3>
                <p class="mb-2">تعتبر بديلاً قوياً لـ VLOOKUP، وتسمح بالبحث في أي عمود وليس فقط العمود الأول.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =INDEX(array, MATCH(lookup_value, lookup_array, [match_type]))
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =INDEX(B1:B10, MATCH("معرف_المنتج", A1:A10, 0)) <br>
                    تبحث عن "معرف_المنتج" في العمود A وتعيد القيمة المقابلة من العمود B.
                </div>
            </div>

            <!-- TEXT Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">9. TEXT (تنسيق النص)</h3>
                <p class="mb-2">تحول قيمة إلى نص وتطبق عليها تنسيقاً رقمياً محدداً.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =TEXT(value, format_text)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =TEXT(A1, "yyyy-mm-dd") <br>
                    يحول التاريخ في الخلية A1 إلى تنسيق "سنة-شهر-يوم".
                </div>
            </div>

            <!-- DATE Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">10. DATE (التاريخ)</h3>
                <p class="mb-2">تنشئ تاريخاً صالحاً من سنة وشهر ويوم محددين.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =DATE(year, month, day)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =DATE(2023, 7, 29) <br>
                    ينشئ تاريخ 29 يوليو 2023.
                </div>
            </div>

            <!-- LEFT Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">11. LEFT (يسار)</h3>
                <p class="mb-2">تستخرج عدداً محدداً من الأحرف من بداية سلسلة نصية.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =LEFT(text, [num_chars])
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =LEFT("مرحباً بك", 4) <br>
                    تعيد "مرح".
                </div>
            </div>

            <!-- RIGHT Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">12. RIGHT (يمين)</h3>
                <p class="mb-2">تستخرج عدداً محدداً من الأحرف من نهاية سلسلة نصية.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =RIGHT(text, [num_chars])
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =RIGHT("مرحباً بك", 3) <br>
                    تعيد "بك".
                </div>
            </div>

            <!-- MID Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">13. MID (وسط)</h3>
                <p class="mb-2">تستخرج عدداً محدداً من الأحرف من منتصف سلسلة نصية، بدءاً من موضع معين.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =MID(text, start_num, num_chars)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =MID("دليل الإكسل", 5, 6) <br>
                    تعيد "الإكسل".
                </div>
            </div>

            <!-- LEN Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">14. LEN (طول النص)</h3>
                <p class="mb-2">تحسب عدد الأحرف في سلسلة نصية.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =LEN(text)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =LEN("الإكسل") <br>
                    تعيد 6.
                </div>
            </div>

            <!-- TRIM Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">15. TRIM (إزالة المسافات الزائدة)</h3>
                <p class="mb-2">تزيل جميع المسافات الزائدة من النص باستثناء المسافات الفردية بين الكلمات.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =TRIM(text)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =TRIM(" نص بمسافات زائدة ") <br>
                    تعيد "نص بمسافات زائدة".
                </div>
            </div>

            <!-- FIND Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">16. FIND (البحث عن نص)</h3>
                <p class="mb-2">تبحث عن سلسلة نصية داخل سلسلة نصية أخرى، وتعيد موضع البداية للسلسلة الأولى.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =FIND(find_text, within_text, [start_num])
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =FIND("اكسل", "دليل الاكسل") <br>
                    تعيد 6 (موضع حرف الألف في "الاكسل").
                </div>
            </div>

            <!-- REPLACE Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">17. REPLACE (استبدال نص)</h3>
                <p class="mb-2">تستبدل جزءاً من سلسلة نصية بسلسلة نصية أخرى، بناءً على عدد محدد من الأحرف.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =REPLACE(old_text, start_num, num_chars, new_text)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =REPLACE("أهلاً بك", 6, 2, "يا صديقي") <br>
                    تعيد "أهلاً يا صديقي".
                </div>
            </div>

            <!-- SUBSTITUTE Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">18. SUBSTITUTE (استبدال نص محدد)</h3>
                <p class="mb-2">تستبدل جميع تكرارات نص معين بنص آخر في سلسلة نصية.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =SUBSTITUTE(text, old_text, new_text, [instance_num])
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =SUBSTITUTE("تفاح أحمر، تفاح أخضر", "تفاح", "برتقال") <br>
                    تعيد "برتقال أحمر، برتقال أخضر".
                </div>
            </div>

            <!-- TODAY Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">19. TODAY (تاريخ اليوم)</h3>
                <p class="mb-2">تعيد تاريخ اليوم الحالي.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =TODAY()
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =TODAY() <br>
                    تعيد تاريخ اليوم (مثلاً: 2023-07-29).
                </div>
            </div>

            <!-- NOW Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">20. NOW (التاريخ والوقت الحالي)</h3>
                <p class="mb-2">تعيد التاريخ والوقت الحاليين.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =NOW()
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =NOW() <br>
                    تعيد التاريخ والوقت الحاليين (مثلاً: 2023-07-29 10:30).
                </div>
            </div>

            <!-- MAX Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">21. MAX (الحد الأقصى)</h3>
                <p class="mb-2">تعيد أكبر قيمة في قائمة من القيم أو نطاق.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =MAX(number1, [number2], ...)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =MAX(A1:A10) <br>
                    تعيد أكبر قيمة في النطاق A1:A10.
                </div>
            </div>

            <!-- MIN Formula -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">22. MIN (الحد الأدنى)</h3>
                <p class="mb-2">تعيد أقل قيمة في قائمة من القيم أو نطاق.</p>
                <p class="font-semibold mb-1">الصيغة:</p>
                <div class="code-block mb-3">
                    =MIN(number1, [number2], ...)
                </div>
                <p class="font-semibold mb-1">مثال:</p>
                <div class="code-block">
                    =MIN(B1:B10) <br>
                    تعيد أقل قيمة في النطاق B1:B10.
                </div>
            </div>
        </section>

        <!-- Shortcuts Section -->
        <section id="shortcuts" class="content-section mb-12">
            <h2 class="text-3xl font-semibold section-title text-emerald-800">أكثر اختصارات الإكسل استخداماً</h2> <!-- Green title - previously indigo -->
            <p class="text-lg mb-6">
                استخدم هذه الاختصارات لزيادة سرعتك وإنتاجيتك عند العمل على إكسل.
            </p>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>الاختصار</th>
                            <th>الوصف</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><code>Ctrl + S</code></td>
                            <td>حفظ الملف</td>
                        </tr>
                        <tr>
                            <td><code>Ctrl + C</code></td>
                            <td>نسخ</td>
                        </tr>
                        <tr>
                            <td><code>Ctrl + X</code></td>
                            <td>قص</td>
                        </tr>
                        <tr>
                            <td><code>Ctrl + V</code></td>
                            <td>لصق</td>
                        </tr>
                        <tr>
                            <td><code>Ctrl + Z</code></td>
                            <td>تراجع</td>
                        </tr>
                        <tr>
                            <td><code>Ctrl + Y</code></td>
                            <td>إعادة (تقدم)</td>
                        </tr>
                        <tr>
                            <td><code>Ctrl + P</code></td>
                            <td>طباعة</td>
                        </tr>
                        <tr>
                            <td><code>F2</code></td>
                            <td>تعديل محتوى الخلية</td>
                        </tr>
                        <tr>
                            <td><code>Ctrl + 1</code></td>
                            <td>فتح تنسيق الخلايا (Format Cells)</td>
                        </tr>
                        <tr>
                            <td><code>Ctrl + A</code></td>
                            <td>تحديد الكل</td>
                        </tr>
                        <tr>
                            <td><code>Ctrl + F</code></td>
                            <td>بحث</td>
                        </tr>
                        <tr>
                            <td><code>Ctrl + H</code></td>
                            <td>استبدال</td>
                        </tr>
                        <tr>
                            <td><code>Ctrl + Shift + L</code></td>
                            <td>تطبيق/إزالة الفلتر</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Problems Section -->
        <section id="problems" class="content-section mb-12">
            <h2 class="text-3xl font-semibold section-title text-emerald-800">حلول مشاكل الإكسل الشائعة</h2> <!-- Green title - previously indigo -->
            <p class="text-lg mb-6">
                إليك بعض الحلول لأكثر المشاكل شيوعاً التي قد تواجهها عند استخدام إكسل.
            </p>

            <!-- Problem 1 -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">1. ظهور #### بدلاً من القيمة</h3>
                <p class="mb-2">
                    تحدث هذه المشكلة عندما يكون عرض العمود غير كافٍ لعرض القيمة الكاملة.
                </p>
                <p class="font-semibold mb-1">الحل:</p>
                <ul class="list-disc list-inside space-y-1">
                    <li>قم بتوسيع عرض العمود عن طريق سحب الفاصل بين رؤوس الأعمدة.</li>
                    <li>انقر نقراً مزدوجاً على الفاصل لتغيير عرض العمود تلقائياً ليناسب أطول محتوى.</li>
                </ul>
            </div>

            <!-- Problem 2 -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">2. ظهور خطأ #DIV/0!</h3>
                <p class="mb-2">
                    يظهر هذا الخطأ عند محاولة القسمة على صفر (أو على خلية فارغة).
                </p>
                <p class="font-semibold mb-1">الحل:</p>
                <ul class="list-disc list-inside space-y-1">
                    <li>تأكد من أن القيمة في الخلية التي تقسم عليها ليست صفراً.</li>
                    <li>استخدم دالة <code>IFERROR</code> لتجنب ظهور الخطأ، مثل:
                        <div class="code-block mt-2">
                            =IFERROR(A1/B1, "خطأ في القسمة")
                        </div>
                    </li>
                </ul>
            </div>

            <!-- Problem 3 -->
            <div class="card">
                <h3 class="text-2xl font-medium text-emerald-700 mb-3">3. ظهور خطأ #NAME؟</h3>
                <p class="mb-2">
                    يظهر هذا الخطأ عندما لا يتعرف إكسل على اسم دالة أو نطاق.
                </p>
                <p class="font-semibold mb-1">الحل:</p>
                <ul class="list-disc list-inside space-y-1">
                    <li>تأكد من تهجئة اسم الدالة بشكل صحيح.</li>
                    <li>تأكد من أن اسم النطاق (Named Range) الذي تستخدمه موجود وصحيح.</li>
                </ul>
            </div>
        </section>
    </main>

    <footer class="bg-emerald-700 text-white text-center py-4 rounded-t-xl shadow-lg mt-8">
        <p>&copy; 2023 المحاسب الشاطر. جميع الحقوق محفوظة.</p>
    </footer>

    <!-- JavaScript for Navigation, Password and AI API Call -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {

            // Password Overlay Logic
            const passwordOverlay = document.getElementById('password-overlay');
            const passwordInput = document.getElementById('password-input');
            const passwordButton = document.getElementById('password-button');
            const passwordMessage = document.getElementById('password-message');
            
            // تم تحديث كلمات المرور لتقبل أي كود من القائمة الموجودة في الصورة
            const correctPasswords = [
                'A6S9Y8', 'B3Q7P2', 'Z1W8X4', 'Y4K5H3', 'E2R6T9', 'V7L3J5', 'C9P1N7',
                'D5F8M2', 'L1J9X4', 'G4B2P8', 'H7K3M9', 'F6R5G1', 'N9P2T4', 'M8W6Y3',
                'R5C1E7', 'K3Z4D8', 'P2X9A1', 'Q7T6F5', 'W1H8B9', 'S4V3J2', 'U9E7P6',
                'A6R2Y3', 'B5K8C4', 'Z7F1M9', 'Y3D9E5', 'E4R6T8', 'V1L2J7', 'C8P4N6',
                'D2F5M1', 'L9J4X3', 'G7B1P5', 'H3K8M6', 'F5R1G9', 'N2P4T7', 'M6W3Y9',
                'R1C8E2', 'K4Z5D3', 'P9X1A8', 'Q6T2F7', 'W8H5B4', 'S3V9J6', 'U7E1P2'
            ];

            // Function to handle password check
            const checkPassword = () => {
                if (correctPasswords.includes(passwordInput.value)) {
                    passwordOverlay.classList.add('hidden');
                    // Hide the overlay after the animation
                    setTimeout(() => {
                        passwordOverlay.style.display = 'none';
                    }, 500);
                } else {
                    passwordMessage.classList.remove('hidden');
                    passwordInput.value = ''; // Clear the input
                }
            };

            // Event listener for the button click
            passwordButton.addEventListener('click', checkPassword);

            // Event listener for the Enter key on the input field
            passwordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });

            // Navigation Logic
            const navButtons = document.querySelectorAll('.nav-button');
            const sections = document.querySelectorAll('.content-section');

            navButtons.forEach(button => {
                button.addEventListener('click', () => {
                    // Remove active class from all buttons and sections
                    navButtons.forEach(btn => btn.classList.remove('active', 'bg-emerald-800'));
                    sections.forEach(section => section.classList.remove('active'));

                    // Add active class to the clicked button and its corresponding section
                    const targetId = button.getAttribute('data-target');
                    document.getElementById(targetId).classList.add('active');
                    button.classList.add('active', 'bg-emerald-800');
                });
            });

            // AI API Logic
            const aiInput = document.getElementById('ai-input');
            const aiButton = document.getElementById('ai-button');
            const aiLoading = document.getElementById('ai-loading');
            const aiOutput = document.getElementById('ai-output');
            const aiResponseContent = document.getElementById('ai-response-content');
            const imageUpload = document.getElementById('image-upload');
            const imagePreviewContainer = document.getElementById('image-preview-container');
            const imagePreview = document.getElementById('image-preview');
            const clearImageButton = document.getElementById('clear-image');
            
            let selectedFile = null;

            // Handle image upload and preview
            imageUpload.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    selectedFile = file;
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        imagePreview.src = event.target.result;
                        imagePreviewContainer.classList.remove('hidden');
                    };
                    reader.readAsDataURL(file);
                } else {
                    selectedFile = null;
                    imagePreviewContainer.classList.add('hidden');
                    imageUpload.value = '';
                }
            });

            clearImageButton.addEventListener('click', () => {
                selectedFile = null;
                imagePreview.src = '';
                imagePreviewContainer.classList.add('hidden');
                imageUpload.value = '';
            });

            // Function to convert Markdown tables to HTML
            function convertMarkdownTableToHtml(markdownTable) {
                const rows = markdownTable.trim().split('\n');
                let html = '<div class="table-container"><table>';
                // Process header
                const headers = rows[0].split('|').map(h => h.trim()).filter(h => h);
                html += '<thead><tr>' + headers.map(h => '<th>' + h + '</th>').join('') + '</tr></thead>';
                // Process body
                if (rows.length > 2) {
                    html += '<tbody>';
                    for (let i = 2; i < rows.length; i++) {
                        const row = rows[i].split('|').map(c => c.trim()).filter(c => c);
                        html += '<tr>' + row.map(c => '<td>' + c + '</td>').join('') + '</tr>';
                    }
                    html += '</tbody>';
                }
                html += '</table></div>';
                return html;
            }
            
            aiButton.addEventListener('click', async () => {
                const userPrompt = aiInput.value.trim();
                if (userPrompt === '' && !selectedFile) {
                    return;
                }

                aiOutput.classList.add('hidden');
                aiLoading.classList.remove('hidden');
                aiResponseContent.innerHTML = '';
                
                try {
                    let combinedPrompt = `أجب بشكل مباشر وموجز على السؤال. لا تقدم أمثلة إلا إذا طُلب منك ذلك صراحةً. ${userPrompt}`;
                    let chatHistory = [{
                        role: "user",
                        parts: []
                    }];
                    
                    if (userPrompt !== '') {
                        chatHistory[0].parts.push({ text: combinedPrompt });
                    }

                    if (selectedFile) {
                        const reader = new FileReader();
                        reader.onload = async (event) => {
                            const base64Data = event.target.result.split(',')[1];
                            chatHistory[0].parts.push({
                                inlineData: {
                                    mimeType: selectedFile.type,
                                    data: base64Data
                                }
                            });
                            await callApi(chatHistory);
                        };
                        reader.readAsDataURL(selectedFile);
                    } else {
                        await callApi(chatHistory);
                    }
                } catch (error) {
                    aiResponseContent.innerHTML = '<p class="text-red-500">حدث خطأ أثناء الاتصال بالذكاء الاصطناعي. الرجاء التحقق من اتصالك بالإنترنت والمحاولة مرة أخرى.</p>';
                    console.error('Error preparing Gemini API call:', error);
                    aiLoading.classList.add('hidden');
                    aiOutput.classList.remove('hidden');
                }
            });

            async function callApi(chatHistory) {
                try {
                    const payload = { contents: chatHistory };
                    const apiKey = "AIzaSyBog7ED0SHLMZ5myXy9OsQJB7fQrFQHpXI";
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API call failed with status: ${response.status}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        let text = result.candidates[0].content.parts[0].text;
                        
                        // Handle potential markdown code blocks
                        const markdownCodeRegex = /```(.*?)```/gs;
                        text = text.replace(markdownCodeRegex, (match, code) => {
                            const lines = code.trim().split('\n');
                            const language = lines[0].startsWith('excel') ? 'excel' : ''; // Simple language detection
                            const codeContent = lines.slice(language ? 1 : 0).join('\n');
                            return `<div class="code-block">${codeContent.trim()}</div>`;
                        });
                        
                        // Handle potential markdown tables
                        const markdownTableRegex = /^\|.*\|\r?\n(?:\|[-: ]+\|\r?\n)+(?:\|.*\|\r?\n)*$/gm;
                        text = text.replace(markdownTableRegex, (match) => {
                            return convertMarkdownTableToHtml(match);
                        });

                        aiResponseContent.innerHTML = text;
                    } else {
                        aiResponseContent.innerHTML = '<p class="text-red-500">عذراً، لم أتمكن من الحصول على إجابة. الرجاء المحاولة مرة أخرى.</p>';
                        console.error('Unexpected API response structure:', result);
                    }
                } catch (error) {
                    aiResponseContent.innerHTML = '<p class="text-red-500">حدث خطأ أثناء الاتصال بالذكاء الاصطناعي. الرجاء التحقق من اتصالك بالإنترنت والمحاولة مرة أخرى.</p>';
                    console.error('Error calling Gemini API:', error);
                } finally {
                    aiLoading.classList.add('hidden');
                    aiOutput.classList.remove('hidden');
                }
            }
        });
    </script>
</body>
</html>
